<div class="space-y-5">
  <div class="w-full flex justify-between items-center">
    <div>
      <h2 class="text-2xl font-bold">Gestión de Roles y Permisos</h2>
      <h3 class="text-gray-500">
        Configuración de accesos para módulos y páginas
      </h3>
    </div>
    <button
      (click)="onToggleModal()"
      class="flex space-x-3 cursor-pointer p-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white">
      <svg
        class="w-6 h-6 text-white"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="currentColor"
        viewBox="0 0 24 24">
        <path
          fill-rule="evenodd"
          d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4.243a1 1 0 1 0-2 0V11H7.757a1 1 0 1 0 0 2H11v3.243a1 1 0 1 0 2 0V13h3.243a1 1 0 1 0 0-2H13V7.757Z"
          clip-rule="evenodd" />
      </svg>
      <span>Crear Rol</span>
    </button>
  </div>

  <div class="flex space-x-10">
    <div
      class="rounded-lg items-center space-x-5 bg-white shadow-sm p-4 flex w-45">
      <svg
        class="w-6 h-6 text-gray-800"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="currentColor"
        viewBox="0 0 24 24">
        <path
          d="M12.356 3.066a1 1 0 0 0-.712 0l-7 2.666A1 1 0 0 0 4 6.68a17.695 17.695 0 0 0 2.022 7.98 17.405 17.405 0 0 0 5.403 6.158 1 1 0 0 0 1.15 0 17.406 17.406 0 0 0 5.402-6.157A17.694 17.694 0 0 0 20 6.68a1 1 0 0 0-.644-.949l-7-2.666Z" />
      </svg>

      <div class="">
        <h2 class="text-2xl font-bold">5</h2>
        <h3 class="text-slate-500">Roles</h3>
      </div>
    </div>
    <div
      class="rounded-lg items-center space-x-5 bg-white shadow-sm p-4 flex w-45">
      <svg
        class="w-6 h-6 text-gray-800"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="currentColor"
        viewBox="0 0 24 24">
        <path
          fill-rule="evenodd"
          d="M8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H6Zm7.25-2.095c.478-.86.75-1.85.75-2.905a5.973 5.973 0 0 0-.75-2.906 4 4 0 1 1 0 5.811ZM15.466 20c.34-.588.535-1.271.535-2v-1a5.978 5.978 0 0 0-1.528-4H18a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2h-4.535Z"
          clip-rule="evenodd" />
      </svg>

      <div class="">
        <h2 class="text-2xl font-bold">5</h2>
        <h3 class="text-slate-500">Usuarios</h3>
      </div>
    </div>
    <div
      class="rounded-lg items-center space-x-5 bg-white shadow-sm p-4 flex w-45">
      <svg
        viewBox="0 0 24 24"
        width="24"
        height="24"
        xmlns="http://www.w3.org/2000/svg"
        fill="#000000">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g
          id="SVGRepo_tracerCarrier"
          stroke-linecap="round"
          stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <title>webpack</title>
          <rect width="24" height="24" fill="none"></rect>
          <path
            d="M21,16.5a1,1,0,0,1-.53.88l-7.9,4.44a1,1,0,0,1-1.14,0l-7.9-4.44A1,1,0,0,1,3,16.5v-9a1,1,0,0,1,.53-.88l7.9-4.44a1,1,0,0,1,1.14,0l7.9,4.44A1,1,0,0,1,21,7.5v9M12,4.15,5,8.09v7.82l7,3.94,7-3.94V8.09L12,4.15m0,2.08,4.9,2.83L12,11.89,7.1,9.06,12,6.23m5,8.66L13,17.2V13.62l4-2.31v3.58M11,17.2,7,14.89V11.31l4,2.31Z"></path>
        </g>
      </svg>
      <div class="">
        <h2 class="text-2xl font-bold">5</h2>
        <h3 class="text-slate-500">Módulos</h3>
      </div>
    </div>
    <div
      class="rounded-lg items-center space-x-5 bg-white shadow-sm p-4 flex w-45">
      <svg
        id="Layer_1"
        data-name="Layer 1"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        width="24"
        height="24"
        ß>
        <polygon points="3 17.43 10.2 21.59 10.2 15.14 3 10.99 3 17.43" />
        <polygon points="13.8 21.59 21 17.43 21 10.99 13.8 15.14 13.8 21.59" />
        <polygon points="3.18 6.94 12 12.03 20.82 6.94 12 1.84 3.18 6.94" />
      </svg>
      <div class="">
        <h2 class="text-2xl font-bold">5</h2>
        <h3 class="text-slate-500">Páginas</h3>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
    <div
      class="col-span-12 md:col-span-2 border border-slate-200 rounded bg-white sticky top-0">
      <div class="w-full p-4">
        <h3 class="text-2xl font-semibold leading-none tracking-tight">
          Roles
        </h3>
      </div>
      <div class="p-0">
        @for (role of roles.value(); track $index) {
          <div
            (click)="onSelectRole(role)"
            [ngClass]="{
              'bg-blue-50 border-blue-500':
                roleSelection()?.roleId === role.roleId,
              'border-transparent': roleSelection()?.roleId !== role.roleId,
            }"
            class="group relative space-y-1 hover:bg-gray-100 p-4 cursor-pointer border-r-2 transition-colors">
            <div
              class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-all flex gap-2">
              <button
                (click)="
                  $event.stopPropagation();
                  onClickEditPermission(
                    role.roleId ?? '',
                    role.roleName,
                    role.roleDescription
                  )
                "
                class="cursor-pointer bg-blue-600 hover:bg-blue-300 p-2 rounded text-white">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-square-pen h-4 w-4">
                  <path
                    d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path
                    d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"></path>
                </svg>
              </button>
              <button
                (click)="
                  $event.stopPropagation(); onDeleteRole(role.roleId ?? '')
                "
                class="cursor-pointer bg-red-500 hover:bg-red-200 p-2 rounded text-white">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-trash2 h-4 w-4">
                  <path d="M3 6h18"></path>
                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                  <line x1="10" x2="10" y1="11" y2="17"></line>
                  <line x1="14" x2="14" y1="11" y2="17"></line>
                </svg>
              </button>
            </div>
            <div class="flex justify-between items-center truncate">
              <span
                class="font-medium text-xl text-gray-900 truncate"
                title="{{ role.roleName }}"
                >{{ role.roleName }}</span
              >
              <span class="rounded-full bg-slate-300 px-5 py-0.5 font-semibold"
                >2</span
              >
            </div>
            <p
              class="text-sm text-gray-500 line-clamp-3"
              title="{{ role.roleDescription }}">
              {{ role.roleDescription || "Sin descripción" }}
            </p>
            <div class="flex items-center space-x-1 text-gray-500">
              <svg
                class="w-3 h-3"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H6Zm7.25-2.095c.478-.86.75-1.85.75-2.905a5.973 5.973 0 0 0-.75-2.906 4 4 0 1 1 0 5.811ZM15.466 20c.34-.588.535-1.271.535-2v-1a5.978 5.978 0 0 0-1.528-4H18a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2h-4.535Z"
                  clip-rule="evenodd" />
              </svg>
              <span class="text-sm">2 Usuarios</span>
            </div>
          </div>
        }
      </div>
    </div>

    <div
      class="col-span-12 md:col-span-10 border border-slate-200 rounded bg-white min-h-100 p-6 space-y-4">
      @if (roleSelection()) {
        @for (m of modules.value(); track $index) {
          <div
            (click)="onToggleFold(m.moduleName)"
            class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors">
            <div class="p-2 rounded-lg text-blue-600 bg-blue-100">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-package h-5 w-5">
                <path d="m7.5 4.27 9 5.15"></path>
                <path
                  d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
                <path d="m3.3 7 8.7 5 8.7-5"></path>
                <path d="M12 22V12"></path>
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-gray-900">{{ m.moduleLabel }}</h3>
              <p class="text-sm text-gray-600">{{ m.page.length }} páginas</p>
            </div>
            <svg
              [class.rotate-90]="foldModule.has(m.moduleName)"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-chevron-right h-5 w-5 text-gray-500 transition-all duration-200">
              <path d="m9 18 6-6-6-6"></path>
            </svg>
          </div>

          @for (p of m.page; track $index) {
            <div
              [class.max-h-0]="!foldModule.has(m.moduleName)"
              [class.max-h-[1000px]]="foldModule.has(m.moduleName)"
              class="overflow-hidden transition-all duration-300">
              <div class="ml-4 p-4 border rounded-lg border-gray-300 bg-white">
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center gap-3">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-warehouse h-4 w-4 text-gray-600">
                      <path
                        d="M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"></path>
                      <path d="M6 18h12"></path>
                      <path d="M6 14h12"></path>
                      <rect width="12" height="12" x="6" y="10"></rect>
                    </svg>
                    <div>
                      <h4 class="font-medium text-gray-900">
                        {{ p.pageLabel }}
                      </h4>
                      <p class="text-sm text-gray-600">
                        {{ p.pageDescription }}
                      </p>
                    </div>
                  </div>
                </div>
                <div class="flex gap-2 flex-wrap">
                  <button
                    (click)="
                      onEditPermission(
                        p.pageId,
                        'c32093af-60f6-11f0-bb46-005056c00001',
                        'create'
                      )
                    "
                    class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all hover:bg-gray-300 cursor-pointer"
                    [ngClass]="{
                      'bg-green-500 text-white': hasPermission(
                        'create',
                        p.pageId
                      ),
                      'bg-gray-200 text-gray-700': !hasPermission(
                        'create',
                        p.pageId
                      ),
                    }">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-circle-plus h-3 w-3">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M8 12h8"></path>
                      <path d="M12 8v8"></path>
                    </svg>
                    Crear</button
                  ><button
                    (click)="
                      onEditPermission(
                        p.pageId,
                        'cb075ff7-60f6-11f0-bb46-005056c00001',
                        'read'
                      )
                    "
                    class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all hover:bg-gray-300 cursor-pointer"
                    [ngClass]="{
                      'bg-blue-600 text-white': hasPermission('read', p.pageId),
                      'bg-gray-200 text-gray-700': !hasPermission(
                        'read',
                        p.pageId
                      ),
                    }">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-eye h-3 w-3">
                      <path
                        d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path>
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                    Lectura
                  </button>
                  <button
                    (click)="
                      onEditPermission(
                        p.pageId,
                        'd2f825c6-60f6-11f0-bb46-005056c00001',
                        'update'
                      )
                    "
                    class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all hover:bg-gray-300 cursor-pointer"
                    [ngClass]="{
                      'bg-yellow-500 text-white': hasPermission(
                        'update',
                        p.pageId
                      ),
                      'bg-gray-200 text-gray-700': !hasPermission(
                        'update',
                        p.pageId
                      ),
                    }">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-square-pen h-3 w-3">
                      <path
                        d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                      <path
                        d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z" />
                    </svg>
                    Editar</button
                  ><button
                    (click)="
                      onEditPermission(
                        p.pageId,
                        '04c9c06a-60f7-11f0-bb46-005056c00001',
                        'delete'
                      )
                    "
                    class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all hover:bg-gray-300 cursor-pointer"
                    [ngClass]="{
                      'bg-red-500 text-white': hasPermission(
                        'delete',
                        p.pageId
                      ),
                      'bg-gray-200 text-gray-700': !hasPermission(
                        'delete',
                        p.pageId
                      ),
                    }">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-trash2 h-3 w-3">
                      <path d="M3 6h18"></path>
                      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                      <line x1="10" x2="10" y1="11" y2="17" />
                      <line x1="14" x2="14" y1="11" y2="17" />
                    </svg>
                    Eliminar
                  </button>
                </div>
              </div>
            </div>
          }
        }
      }
    </div>
  </div>
</div>

<!-- Modal -->
<div
  (click)="onToggleModal()"
  [ngClass]="toggleModal() ? 'block' : 'hidden'"
  class="modal fixed inset-0 z-50 w-full overflow-hidden bg-gray-800/75 flex justify-center items-center transition-all">
  <div
    (click)="$event.stopPropagation()"
    class="rounded-lg shadow-lg w-[50%] min-h-[30%] relative overflow-y-auto overflow-hidden">
    <!-- Modal Content -->
    <div
      class="relative bg-white rounded-lg h-full w-full flex flex-col space-y-4">
      <div
        class="flex items-center justify-between border-b p-4 border-gray-300 rounded-t">
        <h3 class="text-3xl font-semibold">Creación de Rol / Edición de Rol</h3>
        <button
          type="button"
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
          (click)="onToggleModal()">
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14">
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <!-- Modal Body -->
      <div class="p-4 space-y-4">
        <div class="flex flex-col space-y-2">
          <label class="font-semibold" for="roleName">Nombre:</label>
          <input
            [(ngModel)]="roleName"
            type="text"
            id="roleName"
            class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 placeholder:text-gray-500"
            placeholder="Ej: Administrador, Usuario, Editor, etc." />
        </div>
        <div class="flex flex-col space-y-2">
          <label class="font-semibold" for="roleDescription"
            >Descripción:</label
          >
          <input
            [(ngModel)]="roleDescription"
            type="text"
            id="roleDescription"
            class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 placeholder:text-gray-500"
            placeholder="Ej: Acceso total a todas las funcionalidades y configuraciones del sistema." />
        </div>
      </div>
      <div
        class="flex items-center justify-end border-t border-gray-300 p-4 space-x-5">
        <button
          class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-400">
          Cancelar
        </button>
        <button
          (click)="onSave(roleName(), roleDescription())"
          class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-500">
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>
